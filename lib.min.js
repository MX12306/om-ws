!function(){"use strict";function a(a,b){s=s||{},s[a]=s[a]||[],s[a].push(b)}function b(a,b){s=s||{},a in s!=!1&&s[a].splice(s[a].indexOf(b),1)}function c(a){if(s=s||{},a in s!=!1)for(var b=0;b<s[a].length;b++)s[a][b].apply(this,Array.prototype.slice.call(arguments,1))}function d(a){var b=function(a,b,c){for(var d=new ArrayBuffer(2*c),e=new Uint16Array(d),f=0;c>f;++f)e[f]=a.getUint8(b+f);return String.fromCharCode.apply(null,e)},c=new DataView(a),d=b(c,0,2);if("om"!==d)throw new Error("Invalid packet type");var e={};if(e.version=c.getUint8(2),parseInt(e.version,10)!==parseInt(q,10))throw new Error("Invalid version "+e.version+" in received packet");e.action=c.getUint8(3),e.size=c.getUint32(4),e.data={};for(var f=new Uint8Array(a.slice(8,a.byteLength)),g=function(a,b){if(-1===a.indexOf("."))return void(e.data[a]=b);for(var c=a.split("."),d=e.data,f=0;f<c.length;f++){if("undefined"!=typeof d[c[f]]&&"object"!=typeof d[c[f]])throw new Error("Fail to set "+a+" key. Key "+c[f]+" already present as non object");"undefined"==typeof d[c[f]]&&(d[c[f]]={}),f<c.length-1?"object"==typeof d[c[f]]&&(d=d[c[f]]):d[c[f]]=b}},h="",i=[],j=!0,k=[192,128],l=0;l<f.byteLength-1;l++)f[l]===k[0]&&f[l+1]===k[1]?(i=String.fromCharCode.apply(null,i),j?h=i:g(h,i),i=[],j=!j):f[l]!==k[1]&&i.push(f[l]);return e}function e(a,b){var c=new ArrayBuffer(512),d=new DataView(c);d.setUint8(0,111),d.setUint8(1,109),d.setUint8(2,q),d.setUint8(3,a),d.setUint32(4,0);var e=8,f=function(a){for(var b=0;b<a.length;b++)d.setUint8(e,a[b].charCodeAt(0)),e++},g=function(){d.setUint8(e,192),e++,d.setUint8(e,128),e++};for(var h in b)f(h),g(),f(b[h]+""),g();return d.buffer}function f(a,b){if(!i())throw new Error("Not connected");n.send(e(a,b))}function g(){p=0,u=!0,o=setInterval(function(){h(),c("reconnect",p+1),p>=2&&(u=!1,clearInterval(o),c("error","Fail to reconnect")),p++},3e3)}function h(){i()||(n=new WebSocket(r),n.binaryType="arraybuffer",n.onopen=k,n.onclose=l,n.onmessage=m)}function i(){return n&&1===n.readyState}function j(){i&&(t=!0,n.close())}function k(){u=!1,t=!1,clearInterval(o),c("connect")}function l(){c("disconnect"),t||u||g()}function m(a){if(""!==a.data)try{c("data",d(a.data))}catch(b){c("error","Fail to decode packet:"+b.message)}}var n,o,p,q="{{.version}}",r="ws://{{.endpoint}}/",s={},t=!1,u=!1,v={on:a,off:b,send:f,connect:h,close:j};Object.defineProperty(v,"connected",{get:function(){return i()}}),window.omsocket=v,"function"==typeof window.omSocketReady&&omSocketReady(window.omsocket)}();